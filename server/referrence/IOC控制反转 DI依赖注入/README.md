[控制反转](https://zh.wikipedia.org/wiki/控制反转)

# 控制反转（英语：Inversion of Control，缩写为IoC），是面向对象编程中的一种设计原则，可以用来减低计算机代码之间的耦合度。其中最常见的方式叫做依赖注入（Dependency Injection，简称DI），还有一种方式叫“依赖查找”（Dependency Lookup）。

## 起源

早在2004年，Martin Fowler就提出了“哪些方面的控制被反转了？”这个问题。他总结出是依赖对象的获得被反转了，因为大多数应用程序都是由两个或是更多的类通过彼此的合作来实现业务逻辑，这使得每个对象都需要获取与其合作的对象（也就是它所依赖的对象）的引用。如果这个获取过程要靠自身实现，那么这将导致代码高度耦合并且难以维护和调试。

## 技术描述

Class A中用到了Class B的对象b，一般情况下，需要在A的代码中显式地用 new 建立 B 的对象。

采用依赖注入技术之后，A 的代码只需要定义一个 private 的B对象，不需要直接 new 来获得这个对象，而是通过相关的容器控制程序来将B对象在外部new出来并注入到A类里的引用中。而具体获取的方法、对象被获取时的状态由配置文件（如XML）来指定。

IoC也可以理解为把流程的控制从应用程序转移到框架之中。以前，应用程序掌握整个处理流程；现在，控制权转移到了框架，框架利用一个引擎驱动整个流程的执行，框架会以相应的形式提供一系列的扩展点，应用程序则通过定义扩展的方式实现对流程某个环节的定制，“框架Call应用”。基于MVC的web应用程序就是如此。

## 实现方法

实现控制反转主要有两种方式：依赖注入和依赖查找。两者的区别在于，前者是被动的接收对象，在类A的实例创建过程中即创建了依赖的B对象，通过类型或名称来判断将不同的对象注入到不同的属性中，而后者是主动索取相应类型的对象，获得依赖对象的时间也可以在代码中自由控制。

### 依赖注入

主条目：依赖注入
依赖注入有如下实现方式：

- 基于接口。实现特定接口以供外部容器注入所依赖类型的对象。
- 基于 set 方法。实现特定属性的public set方法，来让外部容器调用传入所依赖类型的对象。
- 基于构造函数。实现特定参数的构造函数，在新建对象时传入所依赖类型的对象。
- 基于注解。基于Java的注解功能，在私有变量前加“@Autowired”等注解，不需要显式的定义以上三种代码，便可以让外部容器传入对应的对象。该方案相当于定义了public的set方法，但是因为没有真正的set方法，从而不会为了实现依赖注入导致暴露了不该暴露的接口（因为set方法只想让容器访问来注入而并不希望其他依赖此类的对象访问）。

### 依赖查找

依赖查找更加主动，在需要的时候通过调用框架提供的方法来获取对象，获取时需要提供相关的配置文件路径、key等信息来确定获取对象的状态

## 控制反转应用实例

### C++

PocoCapsule IoC and DSM framework （页面存档备份，存于互联网档案馆） LGPL开源的，支持完全非侵入C++的控制反转（IoC）及领域特定建模（DSM）容器
hypodermic （页面存档备份，存于互联网档案馆） MIT开源协议，Hypodermic是一个基于C++11开发的控制反转（IoC）容器，它为你的C++对象协作提供依赖注入。Hypodermic灵感来自著名的.NET IoC项目Autofac。

### Java

使用Java语言写成的程序在控制反转容器（Inversion of Control Container）里应用了控制反转(Martin 2004)。软件需要一个来自容器的对象，而容器自行建构对象和它的附属物。ATG 的 Dynamo 应用程序服务器是第一个利用这途径的环境之一，近来关于这些容器的例子包含了 HiveMind、PicoContainer （页面存档备份，存于互联网档案馆）、Spring Framework（注意 Spring 是一个完整的企业平台，而非 IOC容器）、Apache Excalibur、Seasar 和 DPML Metro.

### .NET

- Ninject （页面存档备份，存于互联网档案馆）
- Spring.NET （页面存档备份，存于互联网档案馆）
- ObjectBuilder （页面存档备份，存于互联网档案馆）
- Structuremap （页面存档备份，存于互联网档案馆）
- CastleProject
- Seasar （页面存档备份，存于互联网档案馆）
- Autofac （页面存档备份，存于互联网档案馆）
- Unity （页面存档备份，存于互联网档案馆）
- MET

### PHP

- Phalcon PHP框架中应用了依赖注入：DI in Phalcon （页面存档备份，存于互联网档案馆）
- Laravel PHP框架核心的服务容器支持依赖注入：Service Container
